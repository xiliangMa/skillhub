# Skills商店SaaS平台 - 下一步实施计划

**文档创建日期**: 2026-01-31
**项目状态**: 基础架构完成60-70%，核心业务功能缺失
**参考文档**: `docs/plans/2026-01-28-skillhub-implementation.md`

## 📋 项目当前状态概览

### ✅ 已完成的核心功能
- **基础架构**: Docker Compose + Nginx负载均衡 + 前后端分离
- **数据库**: 完整的PostgreSQL模型 + Redis缓存
- **用户认证**: JWT + 邮箱密码登录/注册 + OAuth 2.0框架
- **API框架**: 技能管理、订单管理、管理后台API
- **前端基础**: Next.js 14 + 国际化 + 响应式UI
- **定时任务**: Cron调度器框架

### ❌ 关键缺失功能（阻碍平台运营）

## 🎯 优先级实施清单

### 优先级1：支付系统集成（必需）
**状态**: 框架存在，实际支付网关未集成
**相关文件**:
- `backend/api/payment/payment.go` (TODO: 123, 143)
- `backend/config/config.go` (支付配置结构)
- 前端购买流程 (`frontend/app/skills/[id]/page.tsx:53`)

**具体任务**:
1. **集成支付宝SDK**
   - 实现Alipay配置和签名验证
   - 完成`AlipayCallback`函数 (`payment.go:142`)
   - 添加支付宝支付URL生成逻辑

2. **集成微信支付SDK**
   - 配置微信支付商户信息
   - 实现JSAPI/H5/扫码支付
   - 添加回调验证

3. **集成Stripe和PayPal**
   - 添加国际支付支持
   - 配置Webhook处理
   - 支持多种货币

4. **统一支付接口**
   - 创建`backend/services/payment/`服务
   - 实现支付渠道动态切换
   - 添加支付状态追踪和重试机制

**依赖**: 无

---

### 优先级2：GitHub爬虫服务（数据来源）
**状态**: 目录缺失，定时任务框架就绪
**相关文件**:
- `backend/services/scheduler/scheduler.go:47-49` (爬虫调用被注释)
- 数据库表: `skills`, `sync_logs` 已定义
- `docker/postgres/init.sql:1350-1351` (默认同步任务)

**具体任务**:
1. **创建爬虫服务目录**
   - `mkdir -p backend/services/crawler/`
   - 实现GitHub API客户端 (`go-github`)
   - 添加SKILL.md格式解析器

2. **实现数据同步逻辑**
   - 增量同步 (基于`last_sync_at`)
   - 数据清洗和标准化
   - 分类和标签自动关联

3. **集成到定时任务**
   - 启用`scheduler.go`中的爬虫调用
   - 添加错误处理和重试
   - 实现同步状态报告

4. **备用数据源**
   - SkillsMP网站爬取 (使用`colly`)
   - 手动技能上传接口

**依赖**: 无

---

### 优先级3：购买验证和下载安全
**状态**: 安全逻辑缺失，存在业务漏洞
**相关文件**:
- `backend/api/skills/skills.go:237` (TODO: 验证购买记录)
- `backend/api/skills/skills.go:333` (TODO: 检查是否已购买)
- `backend/api/skills/skills.go:355` (TODO: 集成支付网关)

**具体任务**:
1. **完善购买验证中间件**
   - 在`DownloadSkill`函数中添加购买验证
   - 创建`middleware/purchase.go`中间件
   - 支持免费技能直接下载

2. **订单状态管理**
   - 支付成功后自动标记订单为已支付
   - 添加退款和取消逻辑
   - 实现购买历史查询

3. **下载安全增强**
   - 添加下载次数限制
   - 实现临时下载令牌
   - 添加反盗版措施

**依赖**: 优先级1完成部分

---

### 优先级4：数据分析服务
**状态**: 服务目录为空，基础统计存在
**相关文件**:
- `backend/api/admin/admin.go:404-467` (基础统计)
- `backend/models/analytics.go` (数据模型)
- `backend/services/analytics/` (目录为空)

**具体任务**:
1. **创建分析服务**
   - `mkdir -p backend/services/analytics/`
   - 实现实时数据收集
   - 添加定时聚合任务

2. **增强统计维度**
   - 用户行为分析 (浏览、搜索、购买)
   - 技能流行度趋势
   - 收入分析和预测

3. **数据可视化API**
   - 日/周/月统计接口
   - 多维度数据对比
   - 导出功能 (CSV/Excel)

4. **Redis缓存优化**
   - 热门数据缓存
   - 排行榜实时更新
   - 性能监控

**依赖**: 无

---

### 优先级5：用户中心页面
**状态**: 页面缺失，API部分存在
**相关文件**:
- `backend/api/auth/auth.go:155-168` (获取用户信息)
- `backend/api/payment/payment.go:161-196` (用户订单)
- 前端缺少 `/dashboard` 路由

**具体任务**:
1. **创建用户中心页面**
   - `frontend/app/dashboard/page.tsx`
   - 购买历史列表
   - 账户信息编辑

2. **我的技能页面**
   - 已购买技能展示
   - 下载历史记录
   - 收藏和评分功能

3. **第三方账号管理**
   - OAuth账号绑定/解绑
   - 账号合并逻辑
   - 隐私设置

4. **通知系统**
   - 订单状态通知
   - 新技能推荐
   - 系统公告

**依赖**: 优先级1, 3部分完成

---

### 优先级6：搜索和发现功能
**状态**: 基础搜索存在，专用页面缺失
**相关文件**:
- `backend/api/skills/skills.go:33-75` (列表搜索)
- 首页搜索框 (`frontend/app/page.tsx:93-97`)
- 缺少 `/search` 页面

**具体任务**:
1. **专用搜索页面**
   - `frontend/app/search/page.tsx`
   - 高级筛选面板
   - 搜索结果分页

2. **搜索功能增强**
   - 全文搜索优化
   - 语义搜索 (AI增强)
   - 搜索历史和建议

3. **发现功能**
   - 个性化推荐
   - 趋势技能发现
   - 分类浏览增强

**依赖**: 无

---

### 优先级7：OAuth服务完善
**状态**: 框架存在，需要验证实现
**相关文件**:
- `backend/services/auth/oauth.go`
- `backend/api/auth/auth.go:170-557` (各平台回调)
- 前端OAuth集成

**具体任务**:
1. **验证各平台集成**
   - 测试GitHub OAuth流程
   - 验证Google OAuth配置
   - 检查国内平台 (微信、飞书、小红书)

2. **错误处理和重试**
   - 添加OAuth失败处理
   - 实现token刷新机制
   - 用户信息合并逻辑

3. **前端OAuth优化**
   - 改进OAuth流程UI
   - 添加加载状态
   - 错误提示优化

**依赖**: 无

---

## 📊 实施顺序建议

### 第一阶段：核心业务上线 (1-2周)
1. **支付系统集成** (优先级1) - 3-4天
2. **GitHub爬虫** (优先级2) - 2-3天
3. **购买验证** (优先级3) - 1-2天

**成果**: 平台可接受真实支付，有技能数据，购买流程安全

### 第二阶段：用户体验完善 (1周)
4. **用户中心** (优先级5) - 2-3天
5. **搜索功能** (优先级6) - 1-2天
6. **OAuth完善** (优先级7) - 1天

**成果**: 完整用户体验，支持第三方登录

### 第三阶段：商业智能增强 (1周)
7. **数据分析服务** (优先级4) - 3-4天
8. **性能优化** - 1-2天

**成果**: 数据驱动决策，系统性能优化

---

## 🛠️ 技术实现要点

### 支付集成注意事项
1. **环境配置**: 确保`.env`包含所有支付密钥
2. **沙盒测试**: 先在沙盒环境测试所有支付渠道
3. **回调安全**: 验证所有支付回调的签名
4. **错误处理**: 完善的支付失败处理和用户通知

### 爬虫实现策略
1. **速率限制**: 遵守GitHub API速率限制
2. **增量同步**: 避免重复请求，节省API配额
3. **数据验证**: 验证SKILL.md格式，过滤无效数据
4. **监控告警**: 同步失败时发送通知

### 前端状态管理
当前缺少状态管理 (`frontend/stores/` 为空)，建议：
1. **添加Zustand store** 用于用户状态
2. **React Query** 用于服务器状态缓存
3. **Context API** 用于主题和国际化

---

## 🔍 质量保证要求

### 测试覆盖
1. **单元测试**: 支付逻辑、爬虫解析、验证中间件
2. **集成测试**: OAuth流程、支付回调、数据同步
3. **端到端测试**: 完整购买流程、用户旅程

### 安全审查
1. **支付安全**: 防止重复支付、金额篡改
2. **数据保护**: 用户隐私数据加密
3. **API安全**: 防止未授权访问、SQL注入

### 性能基准
1. **API响应时间**: < 200ms (P95)
2. **页面加载**: < 2s (首屏)
3. **并发支持**: 至少1000并发用户

---

## 📝 验收标准

### 核心功能完成
- [ ] 用户可以使用支付宝/微信支付购买技能
- [ ] 技能数据每天自动从GitHub同步
- [ ] 只有购买用户才能下载付费技能
- [ ] 用户可以在个人中心查看购买历史
- [ ] 管理后台可以看到完整统计数据

### 质量指标
- [ ] 所有关键API有单元测试
- [ ] 支付回调100%可验证
- [ ] 爬虫同步成功率 > 95%
- [ ] 前端关键用户旅程测试通过

---

## 💡 后续优化建议

完成上述核心功能后，可考虑：

1. **移动端优化**: 响应式设计改进，PWA支持
2. **AI增强**: 智能推荐、语义搜索优化
3. **社交功能**: 技能评价、用户社区
4. **API市场**: 第三方开发者接入
5. **企业版**: 团队管理、批量购买

---

## 📞 技术联系人

- **后端架构**: 参考 `backend/main.go` 和 `backend/config/config.go`
- **前端架构**: 参考 `frontend/app/layout.tsx` 和 `frontend/lib/api.ts`
- **数据库设计**: 参考 `backend/models/` 和 `docker/postgres/init.sql`
- **部署配置**: 参考 `docker-compose.yml` 和 `Makefile`

---
*文档最后更新: 2026-01-31*
*基于代码分析，实际实施时可能需要调整*